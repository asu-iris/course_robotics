

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Numerical Inverse Kinematics &#8212; Modeling and Control of Robots</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lec16-17/nik';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Dynamics (Lagrange formulation)" href="../lec18/dyn.html" />
    <link rel="prev" title="Inverse Velocity Kinematics" href="../lec15/inverse_vk.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/iris_logo_2.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/iris_logo_2.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../lec1/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lec2/configuration.html">Robot Configuration</a></li>




<li class="toctree-l1"><a class="reference internal" href="../lec3-5/basic-kinematics.html">Basic Kinematics</a></li>





<li class="toctree-l1"><a class="reference internal" href="../lec6-8/fk.html">Forward Kinematics</a></li>






<li class="toctree-l1"><a class="reference internal" href="../lec9/ik.html">Inverse Kinematics</a></li>


<li class="toctree-l1"><a class="reference internal" href="../lec10/diff-trans.html">Derivative of Transformation</a></li>


<li class="toctree-l1"><a class="reference internal" href="../lec11-12/jacobian.html">Jacobian</a></li>





<li class="toctree-l1"><a class="reference internal" href="../lec13/singularity.html">Singularity &amp; Redundancy</a></li>


<li class="toctree-l1"><a class="reference internal" href="../lec14/statics.html">Statics</a></li>


<li class="toctree-l1"><a class="reference internal" href="../lec15/inverse_vk.html">Inverse Velocity Kinematics</a></li>



<li class="toctree-l1 current active"><a class="current reference internal" href="#">Numerical Inverse Kinematics</a></li>




<li class="toctree-l1"><a class="reference internal" href="../lec18/dyn.html">Dynamics (Lagrange formulation)</a></li>




<li class="toctree-l1"><a class="reference internal" href="../lec19/control_overview.html">Overview of Robot Control</a></li>



<li class="toctree-l1"><a class="reference internal" href="../lec20/djc.html">Decentralized Joint Control</a></li>



<li class="toctree-l1"><a class="reference internal" href="../lec21/cjc.html">Centralized Joint Control</a></li>


<li class="toctree-l1"><a class="reference internal" href="../lec22/osc.html">Operational Space Control</a></li>


</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Flec16-17/nik.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button"
   title="Open an issue"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lec16-17/nik.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Numerical Inverse Kinematics</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Numerical Inverse Kinematics</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#controller-1-jacobian-pseudo-inverse-or-newton-raphson-method">Controller 1: Jacobian (Pseudo-)Inverse or Newton-Raphson Method</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#controller-2-jacobian-transpose-or-gradient-based-method">Controller 2: Jacobian Transpose or Gradient-Based Method</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#more-discussion">More Discussion</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#definition-of-orientation-error">Definition of Orientation Error</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#euler-angles-error">Euler-Angles Error</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#angle-axis-error">Angle-Axis Error</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quaternion-error">Quaternion Error</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#second-order-ik-algorithms">Second-Order IK Algorithms</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="numerical-inverse-kinematics">
<h1>Numerical Inverse Kinematics<a class="headerlink" href="#numerical-inverse-kinematics" title="Permalink to this heading">#</a></h1>
<p>Recall the problem of Inverse Kinematics (IK): given
<span class="math notranslate nohighlight">\(\boldsymbol{x}_{d}\)</span> (the desired end-effector pose in the operational
space), we want to find the joint value <span class="math notranslate nohighlight">\(\boldsymbol{q}\)</span> such that
<span class="math notranslate nohighlight">\(\boldsymbol{k}(\boldsymbol{q})=\boldsymbol{x}_d\)</span>. Here,
<span class="math notranslate nohighlight">\(\boldsymbol{k}(\cdot)\)</span> is the forward kinematics.</p>
<p>To solve the above IK, we define the following operational space error
between the desired <span class="math notranslate nohighlight">\(\boldsymbol{x}_{d}\)</span> and the current end-effector
pose <span class="math notranslate nohighlight">\(\boldsymbol{x}_{e}\)</span>:</p>
<div class="math notranslate nohighlight">
\[\boldsymbol{e}=\boldsymbol{x}_{d}-\boldsymbol{x}_{e}\]</div>
<p>Consider the time derivative</p>
<div class="math notranslate nohighlight">
\[\dot{\boldsymbol{e}}=\dot{\boldsymbol{x}}_{d}-\dot{\boldsymbol{x}}_{e}=\dot{\boldsymbol{x}}_{d}-\boldsymbol{J}_{A}(\boldsymbol{q}) \dot{\boldsymbol{q}}\]</div>
<p>The above is called <em>error dynamics</em> (an Ordinary Differential
Equation), as it shows the profile of the operational space error
<span class="math notranslate nohighlight">\(\boldsymbol{e}(t)\)</span> over time <span class="math notranslate nohighlight">\(t\)</span>. Here, <span class="math notranslate nohighlight">\(\dot{\boldsymbol{q}}\)</span> can be
viewed as the control input. From a control perspective, we want to find
a feedback control law</p>
<div class="math notranslate nohighlight">
\[\dot{\boldsymbol{q}}= \text{Controller}({\boldsymbol{x}}_d, \dot{\boldsymbol{x}}_d,  {\boldsymbol{q}}, {\boldsymbol{e}})\]</div>
<p>such that, when plug the controller to the error dynamics,
<span class="math notranslate nohighlight">\(\boldsymbol{e}(t)\rightarrow 0\)</span> as <span class="math notranslate nohighlight">\(t\rightarrow \infty\)</span>. The different
controllers leads to different numerical IK algorithms.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="controller-1-jacobian-pseudo-inverse-or-newton-raphson-method">
<h1>Controller 1: Jacobian (Pseudo-)Inverse or Newton-Raphson Method<a class="headerlink" href="#controller-1-jacobian-pseudo-inverse-or-newton-raphson-method" title="Permalink to this heading">#</a></h1>
<p>Let’s define
<span class="math notranslate nohighlight">\(\dot{\boldsymbol{q}}= \text{Controller}({\boldsymbol{x}}_d, \dot{\boldsymbol{x}}_d,  {\boldsymbol{q}}, {\boldsymbol{e}})\)</span>
specifically as</p>
<div class="math notranslate nohighlight">
\[\begin{split}\dot{\boldsymbol{q}}=
\begin{cases}
\boldsymbol{J}_{A}^{-1}(\boldsymbol{q})\left(\dot{\boldsymbol{x}}_{d}+\boldsymbol{K} \boldsymbol{e}\right)  \quad\quad\text{for non-redundant manipulators} \\
\boldsymbol{J}_{A}^{\dagger}\left(\dot{\boldsymbol{x}}_{d}+\boldsymbol{K e}\right)+\left(\boldsymbol{I}_{n}-\boldsymbol{J}_{A}^{\dagger} \boldsymbol{J}_{A}\right) \dot{\boldsymbol{q}}_{0} \quad\quad\text{for redundant manipulators}
\end{cases}\end{split}\]</div>
<p>Submitting the above controllers into the error dynamics, it easy to
verify that</p>
<div class="math notranslate nohighlight">
\[\dot{\boldsymbol{e}}+\boldsymbol{K} \boldsymbol{e}=0 .\]</div>
<p>If <span class="math notranslate nohighlight">\(\boldsymbol{K}\)</span> is a positive definite (usually diagonal) matrix,
the above is asymptotically stable. The error tends to zero along the
trajectory with a convergence rate that depends on the eigenvalues of
<span class="math notranslate nohighlight">\(\boldsymbol{K}\)</span>.</p>
<div class="admonition-background-from-linear-control-systems-course admonition">
<p class="admonition-title">Background from Linear Control Systems course</p>
<p>Generally, given an ordinary differential equation (ODE)
$<span class="math notranslate nohighlight">\(\dot{\boldsymbol{e}}+\boldsymbol{K} \boldsymbol{e}=0 .\)</span><span class="math notranslate nohighlight">\( the solution
\)</span>\boldsymbol{e}(t)$ to the ODE is</p>
<div class="math notranslate nohighlight">
\[\boldsymbol{e}(t)=e^{\boldsymbol{-K}t}\boldsymbol{e}(0)\]</div>
<p>In particular, if <span class="math notranslate nohighlight">\(\boldsymbol{K}\)</span> is diagonal, say</p>
<div class="math notranslate nohighlight">
\[\begin{split}\boldsymbol{K}=\begin{bmatrix}
\lambda_1&amp; &amp; &amp;\\
&amp;\lambda_2 &amp; &amp; \\
&amp; &amp; \ddots &amp;\\
&amp; &amp; &amp; \lambda_r
\end{bmatrix},\end{split}\]</div>
<p>Then, the solution is</p>
<div class="math notranslate nohighlight">
\[\begin{split}\boldsymbol{e}(t)=\begin{bmatrix}
e^{-\lambda_1t}&amp; &amp; &amp;\\
&amp;e^{-\lambda_2t} &amp; &amp; \\
&amp; &amp; \ddots &amp;\\
&amp; &amp; &amp; e^{-\lambda_rt}
\end{bmatrix}\boldsymbol{e}(0)\end{split}\]</div>
<p>Therefore, only if
<span class="math notranslate nohighlight">\(\lambda_1, \lambda_2, ...\lambda_r&gt;0\)</span>,
<span class="math notranslate nohighlight">\(\boldsymbol{e}(t)\rightarrow \boldsymbol{0}\)</span> as <span class="math notranslate nohighlight">\(t\rightarrow \infty\)</span>.</p>
</div>
<p>The block scheme corresponding to the IK algorithm is illustrated below,
where <span class="math notranslate nohighlight">\(\boldsymbol{k}(\cdot)\)</span> indicates the direct kinematics function.</p>
<figure class="align-default" id="ik-jacobian-inverse">
<a class="reference internal image-reference" href="../_images/IK_jacobian_inverse.jpg"><img alt="../_images/IK_jacobian_inverse.jpg" src="../_images/IK_jacobian_inverse.jpg" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 61 </span><span class="caption-text">IK algorithm with Jacobian
inverse</span><a class="headerlink" href="#ik-jacobian-inverse" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition-another-perspective-to-look-at-the-above-jacobian-inverse-controller admonition">
<p class="admonition-title">Another perspective to look at the above Jacobian Inverse Controller</p>
<p>Another perspective to look at the above Jacobian Inverse Controller
is through Newton-Raphson method in solving nonlinear equations**</p>
<p>Specifically, consider the following nonlinear equation from kinematics</p>
<div class="math notranslate nohighlight">
\[\boldsymbol{k}(\boldsymbol{q})=\boldsymbol{x}_d\]</div>
<p>given the desired end-effector pose <span class="math notranslate nohighlight">\(\boldsymbol{x}_d\)</span>.</p>
<p>Assume we are given the current initial guess <span class="math notranslate nohighlight">\(\boldsymbol{q}_t\)</span>. One
can approximate the above kinematics at <span class="math notranslate nohighlight">\(\boldsymbol{q}_k\)</span> using the
first-order Tyler expression:</p>
<div class="math notranslate nohighlight">
\[\boldsymbol{k}(\boldsymbol{q})\approx\boldsymbol{t}(\boldsymbol{q}_t)+\boldsymbol{J}_{A}(\boldsymbol{q}_t)(\boldsymbol{q}-\boldsymbol{q}_t)=\boldsymbol{x}_d\]</div>
<p>By solving the above equation for <span class="math notranslate nohighlight">\(\boldsymbol{q}\)</span>, one can obtain the
next updated guess</p>
<div class="math notranslate nohighlight">
\[\boldsymbol{q}_{t+1}=\boldsymbol{q}_t+\text{inv}\left(\boldsymbol{J}_{A}(\boldsymbol{q}_t)\right)(\boldsymbol{x}_d-\boldsymbol{t}(\boldsymbol{q}_t))=\boldsymbol{q}_t+\text{inv}\left(\boldsymbol{J}_{A}(\boldsymbol{q}_t)\right)\boldsymbol{e}_t\]</div>
<p>where <span class="math notranslate nohighlight">\(\text{inv}\)</span> is the general inverse operation (inverse for square
matrix or pseudo-inverse for non-square matrix). Typically, one also
needs a step size before
<span class="math notranslate nohighlight">\(\text{inv}\left(\boldsymbol{J}(\boldsymbol{q}_t)\right)\)</span> to stabilize
the Newton-Raphson algorithm. The above results can be considered as the
discrete-time interpretation of the Jacobian Inverse IK algorithm if
<span class="math notranslate nohighlight">\(\dot{\boldsymbol{x}}_d=\boldsymbol{0}\)</span>.</p>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="controller-2-jacobian-transpose-or-gradient-based-method">
<h1>Controller 2: Jacobian Transpose or Gradient-Based Method<a class="headerlink" href="#controller-2-jacobian-transpose-or-gradient-based-method" title="Permalink to this heading">#</a></h1>
<div class="admonition-background-about-lyapunov-stability admonition">
<p class="admonition-title">Background about Lyapunov Stability</p>
<p>Consider the following error dynamics (ODE)
$<span class="math notranslate nohighlight">\(\dot{\boldsymbol{e}}(t)=\boldsymbol{f}(\boldsymbol{e}(t)),\quad \text{given}\quad \boldsymbol{x}(0)\)</span>$</p>
<p>If there exists a Lyapunov function <span class="math notranslate nohighlight">\(V(\boldsymbol{e})\)</span> such that</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(V(\boldsymbol{e})&gt;0 \quad \forall \boldsymbol{e} \neq \mathbf{0}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(V(\mathbf{0})=0 \quad \text{only for} \quad \boldsymbol{e}=\boldsymbol{0}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\dot{V}=\frac{dV}{dt}=(\frac{d V}{d\boldsymbol{e}})^T\dot{\boldsymbol{e}}=(\frac{d V}{d\boldsymbol{e}})^T \boldsymbol{f}(\boldsymbol{e}(t))&lt;0 \quad \forall \boldsymbol{e}\)</span></p></li>
</ul>
<p>then, <span class="math notranslate nohighlight">\({\boldsymbol{e}}(t)\rightarrow \boldsymbol{0}\)</span> as
<span class="math notranslate nohighlight">\(t\rightarrow \infty\)</span> (the error is converging).</p>
</div>
<p>Consider <span class="math notranslate nohighlight">\(\dot{\boldsymbol{x}}_{d}=\mathbf{0}\)</span>. Let’s use Lyapunov
function to find another controller such that the error dynamics is
converging. Let’s choose Lyapunov function as</p>
<div class="math notranslate nohighlight">
\[V(\boldsymbol{e})=\frac{1}{2} \boldsymbol{e}^{T} \boldsymbol{K} \boldsymbol{e}\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{K}\)</span> is a symmetric positive definite matrix.
Obviously,</p>
<div class="math notranslate nohighlight">
\[V(\boldsymbol{e})&gt;0 \quad \forall \boldsymbol{e} \neq \mathbf{0}, \quad V(\mathbf{0})=0 \quad \text{only for} \quad \boldsymbol{e}=\boldsymbol{0}\]</div>
<p>Differentiating <span class="math notranslate nohighlight">\(V(\boldsymbol{e})\)</span> with respect to time gives</p>
<div class="math notranslate nohighlight">
\[\dot{V}=\boldsymbol{e}^{T} \boldsymbol{K} \dot{\boldsymbol{x}}_{d}-\boldsymbol{e}^{T} \boldsymbol{K} \dot{\boldsymbol{x}}_{e}=\boldsymbol{e}^{T} \boldsymbol{K} \dot{\boldsymbol{x}}_{d}-\boldsymbol{e}^{T} \boldsymbol{K} \boldsymbol{J}_{A}(\boldsymbol{q}) \dot{\boldsymbol{q}}\]</div>
<p>At this point, since <span class="math notranslate nohighlight">\(\boldsymbol{\dot{x}}_d=\boldsymbol{0}\)</span>, if we
choose</p>
<div class="math notranslate nohighlight">
\[\dot{\boldsymbol{q}}=\boldsymbol{J}_{A}^{T}(\boldsymbol{q}) \boldsymbol{K} \boldsymbol{e}\]</div>
<p>This leads to</p>
<div class="math notranslate nohighlight">
\[\dot{V}=-\boldsymbol{e}^{T} \boldsymbol{K} \boldsymbol{J}_{A}(\boldsymbol{q}) \boldsymbol{J}_{A}^{T}(\boldsymbol{q}) \boldsymbol{K} \boldsymbol{e}\]</div>
<p><span class="math notranslate nohighlight">\(\dot{V}\)</span> is negative definite, under the assumption of full rank for
<span class="math notranslate nohighlight">\(\boldsymbol{J}_{A}(\boldsymbol{q})\)</span>. <span class="math notranslate nohighlight">\(\dot{V}&lt;0\)</span> with <span class="math notranslate nohighlight">\(V&gt;0\)</span> implies the
error dynamics will converge/stabilize to <span class="math notranslate nohighlight">\(\boldsymbol{e}=\mathbf{0}\)</span>,
according to Lyapunov Stablity. The block scheme is illustrated below.</p>
<figure class="align-default" id="ik-jacobian-transpose">
<a class="reference internal image-reference" href="../_images/IK_jacobian_transpose.jpg"><img alt="../_images/IK_jacobian_transpose.jpg" src="../_images/IK_jacobian_transpose.jpg" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 62 </span><span class="caption-text">Block scheme of the inverse kinematics algorithm with Jacobian
transpose</span><a class="headerlink" href="#ik-jacobian-transpose" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition-another-perspective-to-look-at-jacobian-transpose-controller admonition">
<p class="admonition-title">Another perspective to look at Jacobian transpose controller</p>
<p>Specifically, when <span class="math notranslate nohighlight">\(\dot{\boldsymbol{x}}_d=\boldsymbol{0}\)</span>, consider we
want to find the joint value <span class="math notranslate nohighlight">\(\boldsymbol{q}\)</span> by minimizing the error of</p>
<div class="math notranslate nohighlight">
\[\min_{\boldsymbol{q}}\quad\frac{1}{2}||\boldsymbol{k}(\boldsymbol{q})-\boldsymbol{x}_d||^2\]</div>
<p>The gradient descent to update current guess <span class="math notranslate nohighlight">\(\boldsymbol{q}_k\)</span> to next
<span class="math notranslate nohighlight">\(\boldsymbol{q}_{k+1}\)</span></p>
<div class="math notranslate nohighlight">
\[\boldsymbol{q}_{k+1}=\boldsymbol{q}_{k}-\alpha{\left(\frac{d\boldsymbol{k}(\boldsymbol{q})}{d\boldsymbol{q}}\bigg\rvert_{\boldsymbol{q}=\boldsymbol{q}_k}\right)}^{T}(\boldsymbol{k}_{A}(\boldsymbol{q})-\boldsymbol{x}_d)=\boldsymbol{q}_{k}+\alpha{\boldsymbol{J}(\boldsymbol{q}_k)}^{T}\boldsymbol{e}_k\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha\)</span> is the gradient step size. The above results can be
considered as the discrete-time interpretation of the Jacobian transpose
IK algorithm if <span class="math notranslate nohighlight">\(\boldsymbol{\dot{x}}_d=0\)</span>.</p>
</div>
<section id="more-discussion">
<h2>More Discussion<a class="headerlink" href="#more-discussion" title="Permalink to this heading">#</a></h2>
<p>When <span class="math notranslate nohighlight">\(\dot{\boldsymbol{x}}_{d} = \mathbf{0}\)</span> and
<span class="math notranslate nohighlight">\(\mathcal{N}\left(\boldsymbol{J}_{A}^{T}\right) \neq \emptyset\)</span>,
<span class="math notranslate nohighlight">\(\dot{V}\)</span> is only negative semi-definite, since <span class="math notranslate nohighlight">\(\dot{V}=0\)</span> for
<span class="math notranslate nohighlight">\(\boldsymbol{e} \neq \mathbf{0}\)</span> with
<span class="math notranslate nohighlight">\(\boldsymbol{K} \boldsymbol{e} \in \mathcal{N}\left(\boldsymbol{J}_{A}^{T}\right)\)</span>.
In this case, the algorithm can get stuck at
<span class="math notranslate nohighlight">\(\dot{\boldsymbol{q}}=\mathbf{0}\)</span> with <span class="math notranslate nohighlight">\(\boldsymbol{e} \neq \mathbf{0}\)</span>.</p>
<p>When <span class="math notranslate nohighlight">\(\dot{\boldsymbol{x}}_{d} \neq \mathbf{0}\)</span>, in order to obtain
<span class="math notranslate nohighlight">\(\dot{V}&lt;0\)</span> also in this case, it would be sufficient to choose</p>
<div class="math notranslate nohighlight">
\[\begin{split}\dot{\boldsymbol{q}}=
\begin{cases}
\boldsymbol{J}_{A}^{-1}\left(\dot{\boldsymbol{x}}_{d}+\boldsymbol{K} \boldsymbol{e}\right)  \quad\quad\text{for non-redundant manipulators} \\
\boldsymbol{J}_{A}^{\dagger}\left(\dot{\boldsymbol{x}}_{d}+\boldsymbol{K e}\right)+\left(\boldsymbol{I}_{n}-\boldsymbol{J}_{A}^{\dagger} \boldsymbol{J}_{A}\right) \dot{\boldsymbol{q}}_{0} \quad\quad\text{for redundant manipulators}
\end{cases}\end{split}\]</div>
<p>which is exactly the Jacobian inverse controller introduced in the first
section.</p>
<p>Furthermore, we have the following comments on the above Jacobian
transpose controller.</p>
<ul class="simple">
<li><p>In the case of kinematic singularities, we have to use Jacobian
transpose IK because it does not require the inverse/pseudo-inverse
of the Jacobian</p></li>
<li><p>Although the Jacobian transpose IK cannot guarantee the convergence
of the error dynamics when
<span class="math notranslate nohighlight">\(\dot{\boldsymbol{x}}_{d} \neq \mathbf{0}\)</span>, the tracking error
<span class="math notranslate nohighlight">\(\boldsymbol{e}(t)\)</span> is norm-bounded. This is because, when the error
norm is small, the linear term (the first term in <span class="math notranslate nohighlight">\(\dot{V}(t)\)</span>)
prevails in the second quadratic term; when otherwise, the quadratic
term dominates, dragging the error to the small norm.</p></li>
</ul>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="definition-of-orientation-error">
<h1>Definition of Orientation Error<a class="headerlink" href="#definition-of-orientation-error" title="Permalink to this heading">#</a></h1>
<p>Both IK algorithms above require the definition of the error in the
operational space (note that we have used the analytical Jacobian
instead of the geometric Jacobian). This is natural for the position
part of the end-effector</p>
<div class="math notranslate nohighlight">
\[\boldsymbol{e}_{P}=\boldsymbol{p}_{d}-\boldsymbol{p}_{e}(\boldsymbol{q})\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{p}_{d}\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{p}_{e}\)</span> denote respectively
the desired and computed end-effector positions. Its time derivative is</p>
<div class="math notranslate nohighlight">
\[\dot{\boldsymbol{e}}_{P}=\dot{\boldsymbol{p}}_{d}-\dot{\boldsymbol{p}}_{e} .\]</div>
<p>However, the problem arises when we consider defining the orientation
error, which depends on the representation of the orientation. In the
following, let’s consider the typical types of orientation
representation and its error.</p>
<section id="euler-angles-error">
<h2>Euler-Angles Error<a class="headerlink" href="#euler-angles-error" title="Permalink to this heading">#</a></h2>
<p>The orientation error using Euler angles is</p>
<div class="math notranslate nohighlight">
\[\boldsymbol{e}_{O}=\boldsymbol{\phi}_{d}-\boldsymbol{\phi}_{e}(\boldsymbol{q})\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{\phi}_{d}\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{\phi}_{e}\)</span> denote
respectively the desired and computed set of Euler angles. Its time
derivative is</p>
<div class="math notranslate nohighlight">
\[\dot{\boldsymbol{e}}_{O}=\dot{\boldsymbol{\phi}}_{d}-\dot{\boldsymbol{\phi}}_{e}\]</div>
<p>The analytical Jacobian for ZYZ-Euler angles was given in previous
lectures: <span class="math notranslate nohighlight">\(\boldsymbol{J}_{A}=\boldsymbol{T}^{-1}\boldsymbol{J}\)</span> with
<span class="math notranslate nohighlight">\(\boldsymbol{J}\)</span> being the geometric jacobian and</p>
<div class="math notranslate nohighlight">
\[\begin{split}\boldsymbol{T}\left(\phi_{e}\right) =\left[\begin{array}{ccc}
0 &amp; -s_{\varphi} &amp; c_{\varphi} s_{\vartheta} \\
0 &amp; c_{\varphi} &amp; s_{\varphi} s_{\vartheta} \\
1 &amp; 0 &amp; c_{\vartheta}
\end{array}\right] .\end{split}\]</div>
</section>
<section id="angle-axis-error">
<h2>Angle-Axis Error<a class="headerlink" href="#angle-axis-error" title="Permalink to this heading">#</a></h2>
<p>If the desired orientation of the end-effector is given in rotation
matrix
<span class="math notranslate nohighlight">\(\boldsymbol{R}_{d}=\left[\begin{array}{lll}\boldsymbol{n}_{d} &amp; \boldsymbol{s}_{d} &amp; \boldsymbol{a}_{d}\end{array}\right]\)</span>
and current end-effector’s rotation matrix is
<span class="math notranslate nohighlight">\(\boldsymbol{R}_{e}(\boldsymbol{q})=\left[\begin{array}{lll}\boldsymbol{n}_{e}(\boldsymbol{q}) &amp; \boldsymbol{s}_{e}(\boldsymbol{q}) &amp; \boldsymbol{a}_{e}(\boldsymbol{q})\end{array}\right]\)</span>,
the orientation error vector can be defined as</p>
<div class="math notranslate nohighlight">
\[\boldsymbol{e}_{O}=\boldsymbol{r} \sin \vartheta\]</div>
<p>where <span class="math notranslate nohighlight">\(\vartheta\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{r}\)</span> are the angle and axis of the
rotation needed to align <span class="math notranslate nohighlight">\(\boldsymbol{R}\)</span> with <span class="math notranslate nohighlight">\(\boldsymbol{R}_{d}\)</span></p>
<div class="math notranslate nohighlight">
\[\boldsymbol{R}(\vartheta, \boldsymbol{r})=\boldsymbol{R}_{d} \boldsymbol{R}_{e}^{T}(\boldsymbol{q})\]</div>
<p>Via derivation, one can also obtain</p>
<div class="math notranslate nohighlight">
\[\boldsymbol{e}_{O}=\frac{1}{2}\left(\boldsymbol{n}_{e}(\boldsymbol{q}) \times \boldsymbol{n}_{d}+\boldsymbol{s}_{e}(\boldsymbol{q}) \times \boldsymbol{s}_{d}+\boldsymbol{a}_{e}(\boldsymbol{q}) \times \boldsymbol{a}_{d}\right)\]</div>
<p>Differentiating the above error vector with respect to time</p>
<div class="math notranslate nohighlight">
\[\dot{\boldsymbol{e}}_{O}=\boldsymbol{L}^{T} \boldsymbol{\omega}_{d}-\boldsymbol{L} \boldsymbol{\omega}_{e}\]</div>
<p>with</p>
<div class="math notranslate nohighlight">
\[\boldsymbol{L}=-\frac{1}{2}\left(\boldsymbol{S}\left(\boldsymbol{n}_{d}\right) \boldsymbol{S}\left(\boldsymbol{n}_{e}\right)+\boldsymbol{S}\left(\boldsymbol{s}_{d}\right) \boldsymbol{S}\left(\boldsymbol{s}_{e}\right)+\boldsymbol{S}\left(\boldsymbol{a}_{d}\right) \boldsymbol{S}\left(\boldsymbol{a}_{e}\right)\right)\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{S}(\cdot)\)</span> is the skew-symmetric operator. The
operational space error</p>
<div class="math notranslate nohighlight">
\[\begin{split}\dot{\boldsymbol{e}}=\left[\begin{array}{c}
\dot{\boldsymbol{e}}_{P} \\
\dot{\boldsymbol{e}}_{O}
\end{array}\right]=\left[\begin{array}{c}
\dot{\boldsymbol{p}}_{d}-\boldsymbol{J}_{P}(\boldsymbol{q}) \dot{\boldsymbol{q}} \\
\boldsymbol{L}^{T} \boldsymbol{\omega}_{d}-\boldsymbol{L} \boldsymbol{J}_{O}(\boldsymbol{q}) \dot{\boldsymbol{q}}
\end{array}\right]=\left[\begin{array}{c}
\dot{\boldsymbol{p}}_{d} \\
\boldsymbol{L}^{T} \boldsymbol{\omega}_{d}
\end{array}\right]-\left[\begin{array}{cc}
\boldsymbol{I} &amp; \boldsymbol{O} \\
\boldsymbol{O} &amp; \boldsymbol{L}
\end{array}\right] \boldsymbol{J} \dot{\boldsymbol{q}}\end{split}\]</div>
<p>To ensure the error dynamics above is converging to
<span class="math notranslate nohighlight">\(\boldsymbol{e}=\boldsymbol{0}\)</span>, the Jacobian-inverse controller will be</p>
<div class="math notranslate nohighlight">
\[\begin{split}\dot{\boldsymbol{q}}=
\begin{cases}
\boldsymbol{J}^{-1} \boldsymbol{v}  \quad\quad\text{for non-redundant manipulators} \\
\boldsymbol{J}^{\dagger}\boldsymbol{v}+\left(\boldsymbol{I}_{n}-\boldsymbol{J}^{\dagger} \boldsymbol{J}\right) \dot{\boldsymbol{q}}_{0} \quad\quad\text{for redundant manipulators}
\end{cases}\end{split}\]</div>
<p>with</p>
<div class="math notranslate nohighlight">
\[\begin{split}\boldsymbol{v}=\left[\begin{array}{c}
\dot{\boldsymbol{p}}_{d}+\boldsymbol{K}_{P} \boldsymbol{e}_{P} \\
\boldsymbol{L}^{-1}\left(\boldsymbol{L}^{T} \boldsymbol{\omega}_{d}+\boldsymbol{K}_{O} \boldsymbol{e}_{O}\right)
\end{array}\right]\end{split}\]</div>
</section>
<section id="quaternion-error">
<h2>Quaternion Error<a class="headerlink" href="#quaternion-error" title="Permalink to this heading">#</a></h2>
<p>If the desired orientation is given in quaternion
<span class="math notranslate nohighlight">\(\mathcal{Q}_{d}=\left\{\eta_{d}, \boldsymbol{\epsilon}_{d}\right\}\)</span> and
current quaternion of end-effector is
<span class="math notranslate nohighlight">\(\mathcal{Q}_{e}=\left\{\eta_{e}, \boldsymbol{\epsilon}_{e}\right\}\)</span>,
one can define an error quaternion
<span class="math notranslate nohighlight">\(\Delta \mathcal{Q}=\{\Delta \eta, \Delta \epsilon\}\)</span></p>
<div class="math notranslate nohighlight">
\[\Delta \mathcal{Q}=\mathcal{Q}_{d} * \mathcal{Q}_{e}^{-1}\]</div>
<p>which represents the rotation needed to align <span class="math notranslate nohighlight">\(\mathcal{Q}_{e}\)</span> and
<span class="math notranslate nohighlight">\(\mathcal{Q}_{d}\)</span>. <span class="math notranslate nohighlight">\(\Delta \mathcal{Q}=\{1, \mathbf{0}\}\)</span> if and only if
<span class="math notranslate nohighlight">\(\mathcal{Q}_{e}\)</span> and <span class="math notranslate nohighlight">\(\mathcal{Q}_{d}\)</span> are aligned. From the above
error quaternion, one can define the orientation error vector</p>
<div class="math notranslate nohighlight">
\[\boldsymbol{e}_{O}=\Delta \boldsymbol{\epsilon}=\eta_{e}(\boldsymbol{q}) \boldsymbol{\epsilon}_{d}-\eta_{d} \boldsymbol{\epsilon}_{e}(\boldsymbol{q})-\boldsymbol{S}\left(\boldsymbol{\epsilon}_{d}\right) \boldsymbol{\epsilon}_{e}(\boldsymbol{q})\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{S}(\cdot)\)</span> is the skew-symmetric operator. At this
point, we define</p>
<div class="math notranslate nohighlight">
\[\begin{split}\boldsymbol{v}=\left[\begin{array}{l}
\dot{\boldsymbol{p}}_{d}+\boldsymbol{K}_{P} \boldsymbol{e}_{P} \\
\boldsymbol{\omega}_{d}+\boldsymbol{K}_{O} \boldsymbol{e}_{O}
\end{array}\right]\end{split}\]</div>
<p>and set the Jacobian-inverse controller</p>
<div class="math notranslate nohighlight">
\[\begin{split}\dot{\boldsymbol{q}}=
\begin{cases}
\boldsymbol{J}^{-1} \boldsymbol{v}  \quad\quad\text{for non-redundant manipulators} \\
\boldsymbol{J}^{\dagger}\boldsymbol{v}+\left(\boldsymbol{I}_{n}-\boldsymbol{J}^{\dagger} \boldsymbol{J}\right) \dot{\boldsymbol{q}}_{0} \quad\quad\text{for redundant manipulators}
\end{cases}\end{split}\]</div>
<p>Next, we will show using the above controller, we will achieve the
convergence of <span class="math notranslate nohighlight">\(\mathcal{Q}_{e}\)</span> to <span class="math notranslate nohighlight">\(\mathcal{Q}_{d}\)</span>. To do so, we
define the following Lyapunov function</p>
<div class="math notranslate nohighlight">
\[V=\left(\eta_{d}-\eta_{e}\right)^{2}+\left(\boldsymbol{\epsilon}_{d}-\boldsymbol{\epsilon}_{e}\right)^{T}\left(\boldsymbol{\epsilon}_{d}-\boldsymbol{\epsilon}_{e}\right)\]</div>
<p>It can be shown that</p>
<div class="math notranslate nohighlight">
\[\dot{V}=-\boldsymbol{e}_{O}^{T} \boldsymbol{K}_{O} \boldsymbol{e}_{O}\]</div>
<p>To prove the above, we will need to use the following relationships</p>
<div class="math notranslate nohighlight">
\[\boldsymbol\omega_{d}-\boldsymbol\omega_{e}+\boldsymbol{K}_{O} \boldsymbol{e}_{O}=\mathbf{0}\]</div>
<p>which is a result of
<span class="math notranslate nohighlight">\(\dot{\boldsymbol{\omega}}_{O}=\boldsymbol{J}_{O}\dot{\boldsymbol{q}}\)</span>,
and the quaternion derivatives</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\dot{\eta}_{e} &amp; =-\frac{1}{2} \boldsymbol{\epsilon}_{e}^{T} \boldsymbol{\omega}_{e} \\
\dot{\boldsymbol{\epsilon}}_{e} &amp; =\frac{1}{2}\left(\eta_{e} \boldsymbol{I}_{3}-\boldsymbol{S}\left(\boldsymbol{\epsilon}_{e}\right)\right) \boldsymbol{\omega}_{e}
\end{aligned} \qquad\qquad
\begin{aligned}
\dot{\eta}_{d} &amp; =-\frac{1}{2} \boldsymbol{\epsilon}_{d}^{T} \boldsymbol{\omega}_{d} \\
\dot{\boldsymbol{\epsilon}}_{d} &amp; =\frac{1}{2}\left(\eta_{e} \boldsymbol{I}_{3}-\boldsymbol{S}\left(\boldsymbol{\epsilon}_{d}\right)\right) \boldsymbol{\omega}_{d}
\end{aligned}\end{split}\]</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="second-order-ik-algorithms">
<h1>Second-Order IK Algorithms<a class="headerlink" href="#second-order-ik-algorithms" title="Permalink to this heading">#</a></h1>
<p>The above IK algorithms can be defined as first-order algorithms,
meaning that they convert a motion trajectory, specified at the
end-effector in terms of its poses and velocities, into the equivalent
joint positions and velocities. Nevertheless, for control purposes, it
may be necessary to convert a motion trajectory specified in terms of
position, velocity and acceleration into the joint position, velocity
and acceleration.</p>
<p>The time differentiation of the differential kinematics leads to</p>
<div class="math notranslate nohighlight">
\[\ddot{\boldsymbol{x}}_{e}=\boldsymbol{J}_{A}(\boldsymbol{q}) \ddot{\boldsymbol{q}}+\dot{\boldsymbol{J}}_{A}(\boldsymbol{q}, \dot{\boldsymbol{q}}) \dot{\boldsymbol{q}}\]</div>
<p>which gives the relationship between the joint accelerations and the
operational space accelerations. Following the previous route of
defining position and velocity error, we may define the following
acceleration error:</p>
<div class="math notranslate nohighlight">
\[\ddot{\boldsymbol{e}}=\ddot{\boldsymbol{x}}_{d}-\ddot{\boldsymbol{x}}_{e}=\ddot{\boldsymbol{x}}_{d}-\boldsymbol{J}_{A}(\boldsymbol{q}) \ddot{\boldsymbol{q}}-\dot{\boldsymbol{J}}_{A}(\boldsymbol{q}, \dot{\boldsymbol{q}}) \dot{\boldsymbol{q}}\]</div>
<p>Assuming square and non-singular matrix <span class="math notranslate nohighlight">\(\boldsymbol{J}_{A}\)</span>, we may
choose the controller</p>
<div class="math notranslate nohighlight">
\[\ddot{\boldsymbol{q}}=\boldsymbol{J}_{A}^{-1}(\boldsymbol{q})\left(\ddot{\boldsymbol{x}}_{d}+\boldsymbol{K}_{D} \dot{\boldsymbol{e}}+\boldsymbol{K}_{P} \boldsymbol{e}-\dot{\boldsymbol{J}}_{A}(\boldsymbol{q}, \dot{\boldsymbol{q}}) \dot{\boldsymbol{q}}\right)\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{K}_{D}\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{K}_{P}\)</span> are positive
definite matrices. This controller leads to the equivalent linear error
system</p>
<div class="math notranslate nohighlight">
\[\ddot{\boldsymbol{e}}+\boldsymbol{K}_{D} \dot{\boldsymbol{e}}+\boldsymbol{K}_{P} \boldsymbol{e}=\mathbf{0}\]</div>
<p>which is asymptotically stable: the error tends to zero along the
trajectory with a convergence speed depending on the choice of
<span class="math notranslate nohighlight">\(\boldsymbol{K}_{P}\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{K}_{D}\)</span>. The second-order inverse
kinematics algorithm is illustrated below.</p>
<figure class="align-default" id="ik-second-order">
<a class="reference internal image-reference" href="../_images/IK_second_order.jpg"><img alt="../_images/IK_second_order.jpg" src="../_images/IK_second_order.jpg" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 63 </span><span class="caption-text">Block scheme of the second-order inverse kinematics algorithm with
Jacobian
inverse</span><a class="headerlink" href="#ik-second-order" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>In the case of a redundant manipulator, the controller is</p>
<div class="math notranslate nohighlight">
\[\ddot{\boldsymbol{q}}=\boldsymbol{J}_{A}^{\dagger}\left(\ddot{\boldsymbol{x}}_{d}+\boldsymbol{K}_{D} \dot{\boldsymbol{e}}+\boldsymbol{K}_{P} \boldsymbol{e}-\dot{\boldsymbol{J}}_{A}(\boldsymbol{q}, \dot{\boldsymbol{q}}) \dot{\boldsymbol{q}}\right)+\left(\boldsymbol{I}_{n}-\boldsymbol{J}_{A}^{\dagger} \boldsymbol{J}_{A}\right) \ddot{\boldsymbol{q}}_{0}\]</div>
<p>where the vector <span class="math notranslate nohighlight">\(\ddot{\boldsymbol{q}}_{0}\)</span> represents arbitrary joint
accelerations chosen to optimize another objective function.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./lec16-17"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../lec15/inverse_vk.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Inverse Velocity Kinematics</p>
      </div>
    </a>
    <a class="right-next"
       href="../lec18/dyn.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Dynamics (Lagrange formulation)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Numerical Inverse Kinematics</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#controller-1-jacobian-pseudo-inverse-or-newton-raphson-method">Controller 1: Jacobian (Pseudo-)Inverse or Newton-Raphson Method</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#controller-2-jacobian-transpose-or-gradient-based-method">Controller 2: Jacobian Transpose or Gradient-Based Method</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#more-discussion">More Discussion</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#definition-of-orientation-error">Definition of Orientation Error</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#euler-angles-error">Euler-Angles Error</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#angle-axis-error">Angle-Axis Error</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quaternion-error">Quaternion Error</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#second-order-ik-algorithms">Second-Order IK Algorithms</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Wanxin Jin @ IRIS Lab
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>